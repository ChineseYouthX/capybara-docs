import{h as W,u as X,i as O,j as Z,k as ee,t as te,l as se,m as I,n as R,p as s,q as re,w as le,v as ae,R as F,x as ie,y as ue,z as oe,A as ne,B as he,C as T,D as j,E as ce,F as ve,G as me,H as ge,I as de,J as ye,K as ke,L as xe,M as U,N as pe,O as q}from"./app-rwJJvoII.js";const fe=["/portfolio.html","/","/blog/","/front-end/","/bookmark/","/notes/","/other/","/front-end/code-style/","/other/rk/","/other/rk/gx/","/other/rk/gx/01/note.html","/other/rk/gx/01/","/other/rk/gx/02/","/other/rk/gx/03/","/other/rk/gx/04/","/other/rk/gx/05/","/other/rk/gx/06/1.html","/other/rk/gx/06/2.html","/other/rk/gx/06/3.html","/other/rk/gx/06/4.html","/other/rk/gx/06/5.html","/other/rk/gx/06/6.html","/other/rk/gx/06/7.html","/other/rk/gx/06/8.html","/other/rk/gx/06/9.html","/other/rk/gx/06/","/other/rk/gx/09/","/other/rk/gx/08/1.html","/other/rk/gx/08/2.html","/other/rk/gx/08/","/other/rk/gx/07/1.html","/other/rk/gx/07/2.html","/other/rk/gx/07/3.html","/other/rk/gx/07/4.html","/other/rk/gx/07/","/other/rk/gx/10/","/other/rk/gx/11/","/other/rk/gx/14/","/other/rk/gx/13/","/other/rk/gx/12/","/other/rk/gx/15/","/other/rk/gx/16/","/other/rk/gx/17/","/other/rk/gx/18/","/other/rk/gx/19/","/other/rk/gx/20/","/other/rk/gx/21/","/other/rk/gx/22/","/other/rk/gx/24/","/other/rk/gx/23/","/other/rk/gx/25/","/404.html","/category/","/tag/","/article/","/star/","/timeline/"],He="SLIMSEARCH_QUERY_HISTORY",y=U(He,[]),Re=()=>{const{queryHistoryCount:l}=q;return{enabled:l>0,queryHistories:y,addQueryHistory:u=>{y.value=Array.from(new Set([u,...y.value.slice(0,l-1)]))},removeQueryHistory:u=>{y.value=[...y.value.slice(0,u),...y.value.slice(u+1)]}}},$=l=>fe[l.id]+("anchor"in l?`#${l.anchor}`:""),qe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=q,k=U(qe,[]),we=()=>({enabled:M>0,resultHistories:k,addResultHistory:i=>{{const u={link:$(i),display:i.display};"header"in i&&(u.header=i.header),k.value=[u,...k.value.slice(0,M-1)]}},removeResultHistory:i=>{k.value=[...k.value.slice(0,i),...k.value.slice(i+1)]}}),Qe=l=>{const i=ce(),u=O(),w=ve(),o=I(0),x=R(()=>o.value>0),c=me([]);return ge(()=>{const{search:Q,terminate:m}=de(),p=ke(g=>{const{resultsFilter:C=r=>r,querySplitter:d,suggestionsFilter:b,...a}=i.value;g?(o.value+=1,Q(g,u.value,a).then(r=>C(r,g,u.value,w.value)).then(r=>{o.value-=1,c.value=r}).catch(r=>{console.warn(r),o.value-=1,o.value||(c.value=[])})):c.value=[]},q.searchDelay-q.suggestDelay,{maxWait:5e3});ye([l,u],([g])=>p(g.join(" "))),xe(()=>{m()})}),{isSearching:x,results:c}};var Se=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:i}){const u=X(),w=O(),o=Z(ee),{addQueryHistory:x,queryHistories:c,removeQueryHistory:Q}=Re(),{resultHistories:m,addResultHistory:p,removeResultHistory:g}=we(),C=te(l,"queries"),{results:d,isSearching:b}=Qe(C),a=se({isQuery:!0,index:0}),r=I(0),v=I(0),A=R(()=>c.value.length>0||m.value.length>0),S=R(()=>d.value.length>0),L=R(()=>d.value[r.value]||null),_=()=>{const{isQuery:e,index:t}=a;t===0?(a.isQuery=!e,a.index=e?m.value.length-1:c.value.length-1):a.index=t-1},P=()=>{const{isQuery:e,index:t}=a;t===(e?c.value.length-1:m.value.length-1)?(a.isQuery=!e,a.index=0):a.index=t+1},Y=()=>{r.value=r.value>0?r.value-1:d.value.length-1,v.value=L.value.contents.length-1},B=()=>{r.value=r.value<d.value.length-1?r.value+1:0,v.value=0},z=()=>{v.value<L.value.contents.length-1?v.value+=1:B()},G=()=>{v.value>0?v.value-=1:Y()},D=e=>e.map(t=>pe(t)?t:s(t[0],t[1])),J=e=>{if(e.type==="customField"){const t=ne[e.index]||"$content",[n,H=""]=he(t)?t[w.value].split("$content"):t.split("$content");return e.display.map(h=>s("div",D([n,...h,H])))}return e.display.map(t=>s("div",D(t)))},f=()=>{r.value=0,v.value=0,i("updateQuery",""),i("close")},K=()=>s("ul",{class:"slimsearch-result-list"},s("li",{class:"slimsearch-result-list-item"},[s("div",{class:"slimsearch-result-title"},o.value.queryHistory),c.value.map((e,t)=>s("div",{class:["slimsearch-result-item",{active:a.isQuery&&a.index===t}],onClick:()=>{i("updateQuery",e)}},[s(T,{class:"slimsearch-result-type"}),s("div",{class:"slimsearch-result-content"},e),s("button",{class:"slimsearch-remove-icon",innerHTML:j,onClick:n=>{n.preventDefault(),n.stopPropagation(),Q(t)}})]))])),N=()=>s("ul",{class:"slimsearch-result-list"},s("li",{class:"slimsearch-result-list-item"},[s("div",{class:"slimsearch-result-title"},o.value.resultHistory),m.value.map((e,t)=>s(F,{to:e.link,class:["slimsearch-result-item",{active:!a.isQuery&&a.index===t}],onClick:()=>{f()}},()=>[s(T,{class:"slimsearch-result-type"}),s("div",{class:"slimsearch-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(n=>D(n)).flat())]),s("button",{class:"slimsearch-remove-icon",innerHTML:j,onClick:n=>{n.preventDefault(),n.stopPropagation(),g(t)}})]))]));return re("keydown",e=>{if(l.isFocusing){if(S.value){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const t=L.value.contents[v.value];x(l.queries.join(" ")),p(t),u.push($(t)),f()}}else if(e.key==="ArrowUp")_();else if(e.key==="ArrowDown")P();else if(e.key==="Enter"){const{index:t}=a;a.isQuery?(i("updateQuery",c.value[t]),e.preventDefault()):(u.push(m.value[t].link),f())}}}),le([r,v],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!S.value:!A.value}],id:"slimsearch-results"},l.queries.length?b.value?s(ae,{hint:o.value.searching}):S.value?s("ul",{class:"slimsearch-result-list"},d.value.map(({title:e,contents:t},n)=>{const H=r.value===n;return s("li",{class:["slimsearch-result-list-item",{active:H}]},[s("div",{class:"slimsearch-result-title"},e||o.value.defaultTitle),t.map((h,V)=>{const E=H&&v.value===V;return s(F,{to:$(h),class:["slimsearch-result-item",{active:E,"aria-selected":E}],onClick:()=>{x(l.queries.join(" ")),p(h),f()}},()=>[h.type==="text"?null:s(h.type==="title"?ie:h.type==="heading"?ue:oe,{class:"slimsearch-result-type"}),s("div",{class:"slimsearch-result-content"},[h.type==="text"&&h.header?s("div",{class:"content-header"},h.header):null,s("div",J(h))])])})])})):o.value.emptyResult:A.value?[K(),N()]:o.value.emptyHistory)}});export{Se as default};
